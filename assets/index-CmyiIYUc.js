import{r as t,G as y,i as S,j as e,I as M,c as T,u as U,a as q,g as E}from"./index-Bvyn_dXy.js";import{B as K,c as z}from"./Breadcrumbs-BeRkTPsh.js";import{P as Q}from"./ProductsList-c8mZLefH.js";import{L as V}from"./Loader-BZBHTk_L.js";import"./ProductCard-5llVU219.js";const I=t.memo(({label:u,selected:p,options:a,onChange:o})=>{const{theme:r}=t.useContext(y),[s,c]=t.useState(!1),h=t.useRef(null),f=t.useCallback(()=>{c(l=>!l)},[]),w=t.useCallback(l=>{o(l),c(!1)},[o]),g=t.useCallback(l=>{var P;(P=h.current)!=null&&P.contains(l.target)||c(!1)},[]);t.useEffect(()=>{if(s)return document.addEventListener("mousedown",g),()=>document.removeEventListener("mousedown",g)},[s,g]);const x=S[s?"arrow_down":"arrow_right"][r];return e.jsxs("div",{ref:h,className:"dropdown",children:[e.jsx("div",{className:"dropdown__label",children:u}),e.jsxs("button",{className:`dropdown__button ${s?"dropdown__button--open":""}`,onClick:f,"aria-expanded":s,"aria-haspopup":"listbox",children:[e.jsx("span",{className:"dropdown__title",children:p}),e.jsx(M,{icon:x,className:"dropdown__icon"})]}),s&&e.jsx("ul",{className:"dropdown__options",role:"listbox",children:a.map(l=>e.jsx("li",{className:"dropdown__option",role:"option",onClick:()=>w(l),children:l},l))})]})});I.displayName="Dropdown";const b=4,W=({total:u,perPage:p,currentPage:a,onPageChange:o})=>{const{theme:r}=t.useContext(y),s=t.useMemo(()=>Math.ceil(u/p),[u,p]),c=t.useMemo(()=>{const P=Math.floor(b/2);let m=Math.max(1,a-P);const i=Math.min(s,m+b-1);return i-m+1<b&&(m=Math.max(1,i-b+1)),{startPage:m,endPage:i}},[a,s]),h=a===1,f=a===s,w=()=>{h||o(a-1)},g=()=>{f||o(a+1)},x=(P,m,i)=>{const d=P==="prev"?"arrow_left":"arrow_right",N=`${d}__disabled`,j=m?S[N][r]:S[d][r];return e.jsx("button",{className:T("pagination__button",{"pagination__button--disabled":m}),onClick:i,disabled:m,children:e.jsx(M,{icon:j})})},l=()=>{const{startPage:P,endPage:m}=c,i=[];for(let d=P;d<=m;d++)i.push(e.jsx("button",{className:T("pagination__button-page",{"pagination__button-page--active":a===d}),onClick:()=>o(d),children:d},d));return i};return e.jsxs("div",{className:"pagination",children:[x("prev",h,w),e.jsx("div",{className:"pagination__button-container",children:l()}),x("next",f,g)]})},Y=(u,{sortBy:p,query:a})=>{let o=[...u];switch(a&&(o=o.filter(r=>r.name.toLowerCase().includes(a.toLowerCase().trim()))),p){case"Newest":return o.sort((r,s)=>s.year-r.year);case"Alphabetically":return o.sort((r,s)=>r.name.localeCompare(s.name));case"Cheapest":return o.sort((r,s)=>r.fullPrice-s.fullPrice);default:return o}},v="Newest",L="All",A=1,H=["Newest","Alphabetically","Cheapest"],J=["4","8","16","All"],X=500,ae=({category:u})=>{const{allProducts:p}=t.useContext(y),[a,o]=t.useState(!1),[r,s]=t.useState(null),[c,h]=U(),f=q(),w=c.get("sort")||v,g=c.get("perPage")||L,x=Number(c.get("page"))||A,l=c.get("query")||"",P=t.useMemo(()=>f.pathname.split("/")[1],[f.pathname]),m=t.useMemo(()=>p.filter(n=>n.category===u),[p,u]),i=t.useMemo(()=>Y(m,{sortBy:w,query:l}),[m,l,w]),d=i.length,N=t.useMemo(()=>{const n=g===L,_=Number(g),C=n?1:Math.ceil(d/_),$=(x-1)*_;return{isShowingAll:n,itemsPerPageNum:_,totalPages:C,startIndex:$}},[g,d,x]),j=t.useMemo(()=>{const{isShowingAll:n,startIndex:_,itemsPerPageNum:C}=N;return n?i:i.slice(_,_+C)},[i,N]),k=t.useCallback(n=>{o(!0),h(E(c,n===v?{sort:null}:{sort:n}))},[c,h]),O=t.useCallback(n=>{o(!0),h(E(c,n===L?{perPage:null,page:null}:{perPage:n,page:"1"}))},[c,h]),R=t.useCallback(n=>{o(!0),window.scrollTo({top:0,behavior:"smooth"});const _=n===A?{page:null}:{page:String(n)};h(E(c,_))},[c,h]),B=t.useCallback(()=>{window.location.reload()},[]);t.useEffect(()=>{o(!0),s(null);const n=setTimeout(()=>{try{p!=null&&p.length||s("Failed to load products")}catch{s("Failed to load products")}finally{o(!1)}},X);return()=>clearTimeout(n)},[u,p,w,g,x,l]);const F=()=>e.jsxs("div",{className:"productPage__error",children:[e.jsx("p",{children:"Something went wrong. Please try again."}),e.jsx("button",{onClick:B,children:"Reload"})]}),G=()=>l?e.jsx("p",{className:"productPage__no-products",children:`There are no ${P} matching the query`}):e.jsx("div",{className:"productPage__no-products",children:e.jsxs("p",{children:["There are no ",u," yet."]})}),D=()=>e.jsxs(e.Fragment,{children:[e.jsx(K,{productType:u}),e.jsxs("h1",{className:"productPage__title",children:[z(u)," page"]}),e.jsx("span",{className:"productPage__description",children:`${d} model${d!==1?"s":""}`}),e.jsxs("div",{className:"productPage__dropdown",children:[e.jsx("div",{className:"productPage__dropdown--sortBy",children:e.jsx(I,{label:"Sort by",selected:w,options:H.slice(),onChange:k})}),e.jsx("div",{className:"productPage__dropdown--itemsPerPage",children:e.jsx(I,{label:"Items on page",selected:g,options:J.slice(),onChange:O})})]}),e.jsx(Q,{products:j,displayType:"with-discount"}),!N.isShowingAll&&N.totalPages>1&&e.jsx(W,{total:d,perPage:N.itemsPerPageNum,currentPage:x,onPageChange:R})]});return e.jsxs("div",{className:"productPage",children:[a&&e.jsx(V,{}),!a&&r&&F(),!a&&!r&&!i.length&&G(),!a&&!r&&i.length>0&&D()]})};export{ae as ProductPage};
